# О Академии Градосферы

Образовательный раздел платформы, где каждый участник может обучаться и совершенствовать навыки благоустройства, получая доступ к курсам за жетоны Благо. Система обучения интегрирована в экосистему ДАО: получение, прохождение и сертификация курсов полностью автоматизированы и основаны на Web3-технологиях.

Ключевые особенности Академии:

— Нативное мини-приложение — не нужно выходить из Telegram. Учащиеся мгновенно получают доступ к контенту в интерфейсе, оптимизированном для повышения вовлечённости и удержания.

— Встроенная аналитика — отслеживайте прогресс учащихся прямо в приложении или интегрируйте с Google Analytics для получения более глубокой и структурированной информации.

— Удобная монетизация — принимайте платежи прямо в приложении, устанавливайте гибкие тарифы (разовые или многоуровневые) и предоставляйте платный контент за жетоны Благо, не прибегая к услугам сторонних платформ.

— Интеграция с TON Connect — подключайте кошельки за считанные секунды и получайте платежи без лишних усилий благодаря встроенной поддержке блокчейна TON.

Академия позволяет преподавателям, авторам и тренерам создавать увлекательные и масштабируемые программы микрообучения — там, где уже находится их аудитория: в Telegram.

## Начало работы

Следуйте инструкциям ниже, чтобы настроить мини-приложение:

1. Откройте мини-приложение для учителей в Telegram, выполнив поиск бота @academy_gradosphera_bot или перейдя по этой ссылке: https://t.me/academy_gradosphera_bot/academy_mini_app.

2. Во время обучения вы можете открыть страницу платежей и подключить любой TON-кошелёк для получения средств. Вы также можете пропустить этот шаг и подключить свой кошелёк позже в приложении.

3. На главной странице нажмите «Добавить токен» и следуйте инструкциям, чтобы создать мини-приложение, в котором ученики получат доступ к вашим продуктам.

4. Вы можете открыть демо-версию продукта или создать новый для своих учеников.

5. В продукте нажмите «Цена», чтобы открыть страницу, на которой вы можете выбрать, включать ли бесплатные уроки и добавить варианты цен:

— Одна цена — ученики получают доступ ко всем платным урокам за единую плату;

— Несколько тарифов — создайте несколько тарифных планов с разными ценами и доступом только к выбранным урокам в рамках каждого тарифного плана.

После завершения нажмите «Сохранить».

6. После настройки продукта нажмите «Опубликовать» на странице продукта, чтобы он стал виден учащимся в их мини-приложении.

7. Если вы не настроили платежи во время регистрации, откройте страницу профиля, перейдите в настройки выплат и подключите свой TON-кошелёк.

Выполнив описанные выше шаги, вы можете протестировать созданное мини-приложение для учащихся.

Мини-приложение для учащихся:

1. Откройте созданный продукт. Если преподаватель сделал все уроки платными, они будут отображаться заблокированными. Нажмите на любой заблокированный урок, чтобы открыть платный доступ. Выберите тариф и следуйте инструкциям, чтобы подключить TON-кошелёк и завершить оплату.

2. После завершения оплаты подтверждение получения и разблокировка доступа к продукту обычно занимают несколько минут.

3. Чтобы проверить, был ли платёж успешным, перейдите в свой профиль и откройте страницу «История платежей».

## Сборка проекта

Чтобы собрать проект для развёртывания (например, на GitHub Pages или любом статическом хостинге), выполните следующие действия:

Создайте файл .env

```bash
cp .env.example env
```

1. **Установите зависимостей**

Убедитесь, что у вас установлены [Node.js](https://nodejs.org/) (рекомендуется версия 20+ или выше) и [npm](https://www.npmjs.com/).

```bash
npm install
```

2. **Соберите проект**

Это создаст папку `dist` с готовыми к использованию статическими файлами:

```bash
npm run build
```

3. **Предварительный просмотр сборки в рабочей среде локально (необязательно)**

Вы можете просмотреть собранный проект локально, чтобы убедиться, что всё работает как надо:

```bash
npm run preview
```

4. **Развертывание**

Загрузите содержимое папки `dist` на предпочитаемый вами сервис хостинга статических файлов (например, GitHub Pages, Vercel, Netlify или на ваш собственный сервер).

5. **Запуск разработки**

`bash
npm run dev
`

---

## Интеграция с TON Connect для платежей

Интеграция платежей и основной логики реализована в [`src/store/walletStore.js`](src/store/walletStore.js) с использованием Pinia для управления состоянием и TON Connect UI SDK.

- **TON Connect UI SDK**: используется для подключения и взаимодействия с TON-кошельком пользователя.
- **TON Client**: взаимодействует с блокчейном TON.
- **JettonMaster и JettonWallet**: используются для обработки жетона Благо (токен в TON).
- **Pinia Store**: управляет состоянием кошелька, подключением и логикой оплаты.

### Схема интеграции

1. **Подключение к кошельку**

- Приложение инициализирует TON Connect UI с помощью URL-адреса манифеста.

- Пользователи подключают свой TON-кошелек через пользовательский интерфейс, и адрес кошелька сохраняется в состоянии.

2. **Подготовка платежа**

- Когда студент инициирует платеж, приложение:
- Отключает все текущие сеансы кошелька и очищает локальное хранилище, чтобы избежать неактивных подключений.
- Переподключает кошелек, чтобы обеспечить новый сеанс.
- Инициализирует клиент TON и получает адрес кошелька жетона (Благо) пользователя.

3. **Проверка баланса**

- Приложение получает данные о балансе TON и Благо:
- Баланс TON извлекается через API TON Center.
- Баланс Благо извлекается из JettonWallet. контракт.
- Если у пользователя недостаточно Благо и сумма меньше 0,1 TON, отображается ошибка.

4. **Выполнение транзакции**

- Приложение формирует и отправляет транзакцию перевода жетона (Благо) с помощью метода `sendTransaction` кошелька через TON Connect.
- Транзакция включает в себя:
- Адрес получателя (из счета на оплату)
- Сумма в Благо (переведенная в корректные десятичные знаки)
- Поле комментария для идентификатора счета
- Комиссия за газ (задается как константа)
- Результат транзакции может быть дополнительно обработан (например, при необходимости извлечь хэш транзакции из BOC).

5. **Обработка после платежа**

- После успешного платежа приложение обновляет состояние, отражая статус платежа, который может использоваться для обновления пользовательского интерфейса или дальнейшей бизнес-логики.

### Технические аспекты и ход мысли

- **Управление сеансами**: Академия обеспечивает актуальность сеансов кошелька, отключая и очищая локальное хранилище перед каждой попыткой оплаты. Это позволяет избежать проблем с устаревшими или недействительными подключениями к кошельку.
- **Безопасность**: Все конфиденциальные операции (например, отправка транзакций) заключены в блоки try/catch для корректной обработки ошибок.
- **Обратная связь с пользователями**: Магазин использует систему всплывающих уведомлений для информирования пользователей об ошибках, таких как нехватка средств.
- **Расширяемость**: Модульная интеграция упрощает поддержку дополнительных жетонов или потоков платежей в будущем.
- **Взаимодействие с блокчейном**: Решение использует данные как внутри сети (контракт жетона), так и вне сети (API TON Center) для обеспечения бесперебойной оплаты.

---
